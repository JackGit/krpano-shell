<!DOCTYPE html>
<html>
<head>
	<title>krpano</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta http-equiv="x-ua-compatible" content="IE=edge" />
	<style>
		@-ms-viewport { width:device-width; }
		@media only screen and (min-device-width:800px) { html { overflow:hidden; } }
		html { height:100%; }
		body { height:100%; overflow:hidden; margin:0; padding:0; font-family:Arial, Helvetica, sans-serif; font-size:16px; color:#FFFFFF; background-color:#000000; }
	</style>
</head>
<body>

<script>
	window.krShell = {};
</script>
<script src="krpano.js"></script>
<script src="../../dist/bundle.js"></script>

<div id="pano" style="width:100%;height:100%;">
	<noscript><table style="width:100%;height:100%;"><tr style="vertical-align:middle;text-align:center;"><td>ERROR:<br><br>Javascript not activated<br><br></td></tr></table></noscript>
	<script>
		embedpano({xml:"krpano.xml", target:"pano", html5:"auto", mobilescale:1.0, passQueryParameters:false});

		var pano;
		var panoName = 'p1';

		krShell.ready(panoName, function () {
			console.log('shell is ready');
			pano = krShell.pano(panoName);
			createScene();
			//setContextMenu();
			//addDraggbleHotspot();
		});

		function createScene () {
			var scene = new krShell.Scene('defaultscene', {
				preview: {
					type: krShell.Preview.TYPE.grid()
				}
			});

			//pano.addScene(scene);
		}

		function setContextMenu () {
			pano.contextMenu.items = [{
				caption: 'start rotate',
				onclick: function () {
					pano.autorotate.start();
				}
			}, {
				caption: 'stop rotate',
				onclick: function () {
					pano.autorotate.stop();
				}
			}, {
				caption: 'set image preview',
				onclick: setImagePreview
			}, {
				caption: 'set grid preview',
				onclick: setGridPreview
			}, {
				caption: 'set image',
				onclick: setImage
			}];
		}

		function addDraggbleHotspot () {
			var h = new krShell.Hotspot('draghotspot', {
				url: 'hotspot.png',
				keep: true,
				ath: 0,
				atv: 0
			});

			h.on('down', function (event) {
				var center = pano.sphereToScreen(h.ath, h.atv);
				var targetX = event.stagex - center.x;
				var targetY = event.stagey - center.y;

				krShell.asyncLoop(function () {
					return h.pressed;
				}, function () {
					var x = event.stagex - targetX;
					var y = event.stagey - targetY;
					var result = pano.screenToSphere(x, y);
					h.ath = result.x;
					h.atv = result.y;
				});
			});
		}

		function setImagePreview () {
			var preview = new krShell.Preview({
				url: 'http://pano10.qncdn.720static.com/resource/prod/58ci8e397n6/1d42fxagxen/1197790/imgs/preview.jpg'
			});
			pano.currentScene.preview = preview;
			pano.currentScene.load();
		}

		function setGridPreview () {
			var preview = new krShell.Preview({type: krShell.Preview.TYPE.grid()});
			pano.currentScene.preview = preview;
			pano.currentScene.load();
		}

		function setImage () {
			var image = new krShell.CubeImage({
				url: 'http://pano10.qncdn.720static.com/resource/prod/58ci8e397n6/1d42fxagxen/1197790/imgs/mobile_%s.jpg'
			});

			pano.currentScene.image = image;
			pano.currentScene.load();
		}
	</script>
</div>

</body>
</html>
